<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Soundboard</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#007AFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Soundboard">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23007AFF'><path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z'/></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --background-color: #F2F2F7;
            --surface-color: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #6D6D70;
            --border-color: #C6C6C8;
            --red-color: #FF3B30;
            --success-color: #28A745;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #000000;
                --surface-color: #1C1C1E;
                --text-primary: #FFFFFF;
                --text-secondary: #8E8E93;
                --border-color: #38383A;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.4;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--background-color);
            position: relative;
        }

        .header {
            background-color: var(--surface-color);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .header-title {
            display: flex;
            flex-direction: column;
        }

        .app-title {
            font-size: 2rem;
            font-weight: bold;
            margin: 0;
        }

        .sound-count {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            transition: all 0.2s ease;
            font-size: 1.25rem;
        }

        .btn:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border-radius: 0.75rem;
        }

        .btn-primary:hover {
            background-color: rgba(0, 122, 255, 0.8);
        }

        .btn-danger {
            color: var(--red-color);
        }

        .search-bar {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            background-color: var(--background-color);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .main-content {
            padding: 1rem;
            min-height: 60vh;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-description {
            margin-bottom: 2rem;
        }

        .sounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
        }

        .sound-card {
            background-color: var(--surface-color);
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .sound-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .sound-card:active {
            transform: scale(0.98);
        }

        .sound-card.playing {
            transform: scale(0.98);
        }

        .sound-play-area {
            aspect-ratio: 1;
            background-color: var(--background-color);
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .sound-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: var(--primary-color);
            opacity: 0.2;
            transition: width 0.1s linear;
        }

        .sound-icon {
            font-size: 2rem;
            z-index: 1;
            position: relative;
            color: var(--primary-color);
        }

        .sound-info {
            text-align: center;
        }

        .sound-name {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .sound-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .file-input {
            display: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background-color: var(--surface-color);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.25rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background-color: var(--background-color);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }

        .btn-secondary {
            background-color: var(--background-color);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            flex: 1;
        }

        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            padding: 1rem;
            display: none;
        }

        .progress-bar.show {
            display: block;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .progress-track {
            height: 4px;
            background-color: var(--background-color);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.1s linear;
        }

        .no-results {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sounds-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .main-content {
                padding: 0.75rem;
            }
            
            .app-title {
                font-size: 1.75rem;
            }
        }

        /* Install prompt */
        .install-prompt {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
            text-align: center;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            display: none;
        }

        .install-prompt.show {
            display: block;
        }

        .sort-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .sort-btn {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            background-color: var(--background-color);
            color: var(--text-primary);
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .sort-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .sort-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Install Prompt -->
        <div class="install-prompt" id="installPrompt">
            <div style="margin-bottom: 0.5rem;">üì± Install this app on your phone!</div>
            <div style="display: flex; gap: 0.5rem; justify-content: center;">
                <button class="btn" onclick="installApp()" style="background: rgba(255,255,255,0.2); color: white; font-size: 0.875rem;">Install</button>
                <button class="btn" onclick="hideInstallPrompt()" style="background: rgba(255,255,255,0.1); color: white; font-size: 0.875rem;">Later</button>
            </div>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <h1 class="app-title">My Soundboard</h1>
                    <div class="sound-count" id="soundCount">0 sounds</div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openImportModal()">
                        ‚ûï Import
                    </button>
                    <button class="btn btn-danger" id="stopBtn" onclick="stopSound()" style="display: none;">
                        ‚èπÔ∏è
                    </button>
                </div>
            </div>

            <div class="search-bar">
                <input type="text" class="search-input" id="searchInput" placeholder="Search sounds..." oninput="filterSounds()">
                <span class="search-icon">üîç</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <div class="empty-state" id="emptyState">
                <span class="empty-icon">üéµ</span>
                <h2 class="empty-title">No Sounds Yet</h2>
                <p class="empty-description">Import audio files to get started with your soundboard</p>
                <button class="btn btn-primary" onclick="openImportModal()">Import Audio Files</button>
            </div>

            <div id="soundsContainer" style="display: none;">
                <div class="sort-controls">
                    <button class="sort-btn active" id="sortName" onclick="setSortMode('name')">üìù Name</button>
                    <button class="sort-btn" id="sortDate" onclick="setSortMode('date')">üìÖ Date Added</button>
                    <button class="sort-btn" id="sortDuration" onclick="setSortMode('duration')">‚è±Ô∏è Duration</button>
                </div>

                <div class="sounds-grid" id="soundsGrid">
                    <!-- Sounds will be populated by JavaScript -->
                </div>
            </div>

            <div class="no-results" id="noResults" style="display: none;">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üîç</div>
                <div>No sounds found</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar" id="progressBar">
            <div class="progress-info">
                <span id="currentSoundName">Sound Name</span>
                <span id="progressTime">0:00 / 0:00</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Import Modal -->
        <div class="modal hidden" id="importModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Import Audio Files</h3>
                    <button class="close-btn" onclick="closeImportModal()">‚úï</button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Audio Files</label>
                    <input type="file" class="file-input" id="audioInput" accept="audio/*" multiple onchange="handleFileImport(event)">
                    <button class="btn btn-primary" onclick="document.getElementById('audioInput').click()">
                        üìÅ Choose Files
                    </button>
                    <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                        Supports MP3, WAV, M4A, and other audio formats
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Sound Modal -->
        <div class="modal hidden" id="editModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Edit Sound</h3>
                    <button class="close-btn" onclick="closeEditModal()">‚úï</button>
                </div>

                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="editName">
                </div>

                <div class="form-group">
                    <label class="form-label">File Info</label>
                    <div id="fileInfo" style="padding: 0.75rem; background-color: var(--background-color); border-radius: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);"></div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="deleteCurrentSound()">Delete</button>
                    <button class="btn btn-primary" onclick="saveCurrentSound()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let sounds = [];
        let currentAudio = null;
        let currentSoundId = null;
        let currentEditingSoundId = null;
        let sortMode = 'name';
        let deferredPrompt = null;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            loadSounds();
            renderSounds();
            setupPWA();
        });

        // PWA Installation
        function setupPWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installPrompt').classList.add('show');
            });

            // Hide install prompt if already installed
            window.addEventListener('appinstalled', () => {
                hideInstallPrompt();
            });
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        hideInstallPrompt();
                    }
                    deferredPrompt = null;
                });
            }
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('show');
        }

        // Sound Management
        function loadSounds() {
            const savedSounds = localStorage.getItem('soundboard-sounds');
            if (savedSounds) {
                sounds = JSON.parse(savedSounds);
                // Convert file data back to File objects
                sounds = sounds.map(sound => ({
                    ...sound,
                    file: new File([new Uint8Array(sound.fileData)], sound.fileName, { type: sound.fileType })
                }));
            }
            updateSoundCount();
        }

        function saveSounds() {
            // Convert File objects to serializable data
            const soundsToSave = sounds.map(sound => ({
                ...sound,
                fileData: Array.from(new Uint8Array(sound.fileArrayBuffer)),
                fileType: sound.file.type,
                fileName: sound.file.name,
                file: undefined // Remove the File object before saving
            }));
            
            localStorage.setItem('soundboard-sounds', JSON.stringify(soundsToSave));
            updateSoundCount();
        }

        function updateSoundCount() {
            document.getElementById('soundCount').textContent = `${sounds.length} sound${sounds.length !== 1 ? 's' : ''}`;
        }

        // File Import
        function openImportModal() {
            document.getElementById('importModal').classList.remove('hidden');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.add('hidden');
        }

        async function handleFileImport(event) {
            const files = Array.from(event.target.files);
            
            for (const file of files) {
                if (file.type.startsWith('audio/')) {
                    const arrayBuffer = await file.arrayBuffer();
                    const sound = {
                        id: Date.now() + Math.random(),
                        name: file.name.replace(/\.[^/.]+$/, ""),
                        file: file,
                        fileArrayBuffer: arrayBuffer,
                        dateAdded: new Date().toISOString(),
                        duration: null
                    };
                    
                    // Get duration
                    const audio = new Audio();
                    const url = URL.createObjectURL(file);
                    audio.onloadedmetadata = () => {
                        sound.duration = audio.duration;
                        URL.revokeObjectURL(url);
                        saveSounds();
                        renderSounds();
                    };
                    audio.src = url;
                    
                    sounds.push(sound);
                }
            }
            
            saveSounds();
            renderSounds();
            closeImportModal();
            
            // Clear input
            event.target.value = '';
        }

        // Audio Playback
        function playSound(soundId) {
            const sound = sounds.find(s => s.id === soundId);
            if (!sound) return;

            // Stop current audio
            stopSound();

            // Create new audio
            const url = URL.createObjectURL(sound.file);
            currentAudio = new Audio(url);
            currentSoundId = soundId;

            // Setup event listeners
            currentAudio.onended = () => {
                stopSound();
            };

            currentAudio.ontimeupdate = () => {
                updateProgress();
            };

            currentAudio.onloadedmetadata = () => {
                updateProgress();
            };

            // Play audio
            currentAudio.play().then(() => {
                showProgressBar(sound);
                updateSoundButtons();
            }).catch(err => {
                console.error('Playback failed:', err);
                stopSound();
            });
        }

        function stopSound() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                if (currentAudio?.src) {
                    URL.revokeObjectURL(currentAudio.src);
                }
            }
            
            currentSoundId = null;
            hideProgressBar();
            updateSoundButtons();
            document.getElementById('stopBtn').style.display = 'none';
        }

        function showProgressBar(sound) {
            const progressBar = document.getElementById('progressBar');
            const soundName = document.getElementById('currentSoundName');
            
            soundName.textContent = sound.name;
            progressBar.classList.add('show');
            document.getElementById('stopBtn').style.display = 'block';
        }

        function hideProgressBar() {
            document.getElementById('progressBar').classList.remove('show');
        }

        function updateProgress() {
            if (!currentAudio) return;
            
            const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            const currentTime = formatTime(currentAudio.currentTime);
            const totalTime = formatTime(currentAudio.duration);
            document.getElementById('progressTime').textContent = `${currentTime} / ${totalTime}`;
        }

        function formatTime(seconds) {
            if (!seconds || !isFinite(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Sorting
        function setSortMode(mode) {
            sortMode = mode;
            
            // Update button states
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`sort${mode.charAt(0).toUpperCase() + mode.slice(1)}`).classList.add('active');
            
            renderSounds();
        }

        function sortSounds(soundsToSort) {
            return soundsToSort.sort((a, b) => {
                switch (sortMode) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'date':
                        return new Date(b.dateAdded) - new Date(a.dateAdded);
                    case 'duration':
                        if (!a.duration && !b.duration) return 0;
                        if (!a.duration) return 1;
                        if (!b.duration) return -1;
                        return b.duration - a.duration;
                    default:
                        return 0;
                }
            });
        }

        // UI Rendering
        function renderSounds() {
            const filteredSounds = getFilteredSounds();
            const grid = document.getElementById('soundsGrid');
            const emptyState = document.getElementById('emptyState');
            const noResults = document.getElementById('noResults');
            const soundsContainer = document.getElementById('soundsContainer');
            
            // Show/hide appropriate views
            if (sounds.length === 0) {
                emptyState.style.display = 'block';
                soundsContainer.style.display = 'none';
                noResults.style.display = 'none';
            } else if (filteredSounds.length === 0) {
                emptyState.style.display = 'none';
                soundsContainer.style.display = 'none';
                noResults.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                soundsContainer.style.display = 'block';
                noResults.style.display = 'none';
            }
            
            // Render sound cards
            grid.innerHTML = '';
            filteredSounds.forEach(sound => {
                const card = createSoundCard(sound);
                grid.appendChild(card);
            });
        }

        function createSoundCard(sound) {
            const isPlaying = currentSoundId === sound.id;
            
            const card = document.createElement('button');
            card.className = `sound-card ${isPlaying ? 'playing' : ''}`;
            card.onclick = () => playSound(sound.id);
            card.oncontextmenu = (e) => {
                e.preventDefault();
                editSound(sound.id);
            };
            
            // Long press for mobile
            let pressTimer;
            card.ontouchstart = (e) => {
                pressTimer = setTimeout(() => {
                    navigator.vibrate && navigator.vibrate(50);
                    editSound(sound.id);
                }, 500);
            };
            card.ontouchend = () => {
                clearTimeout(pressTimer);
            };
            
            const duration = sound.duration ? formatTime(sound.duration) : '';
            const dateAdded = new Date(sound.dateAdded).toLocaleDateString();
            
            card.innerHTML = `
                <div class="sound-play-area">
                    <div class="sound-progress" style="width: 0%"></div>
                    <div class="sound-icon">
                        ${isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                    </div>
                </div>
                <div class="sound-info">
                    <div class="sound-name">${sound.name}</div>
                    <div class="sound-meta">
                        ${duration || dateAdded}
                    </div>
                </div>
            `;
            
            return card;
        }

        function updateSoundButtons() {
            renderSounds(); // Simple approach - re-render everything
        }

        function getFilteredSounds() {
            let filtered = [...sounds];
            
            // Filter by search
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(s => 
                    s.name.toLowerCase().includes(searchTerm)
                );
            }
            
            return sortSounds(filtered);
        }

        function filterSounds() {
            renderSounds();
        }

        // Edit Sound
        function editSound(soundId) {
            const sound = sounds.find(s => s.id === soundId);
            if (!sound) return;
            
            currentEditingSoundId = soundId;
            document.getElementById('editName').value = sound.name;
            
            // Show file info
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `
                <div><strong>File:</strong> ${sound.file.name}</div>
                <div><strong>Size:</strong> ${(sound.file.size / 1024 / 1024).toFixed(2)} MB</div>
                <div><strong>Duration:</strong> ${sound.duration ? formatTime(sound.duration) : 'Unknown'}</div>
                <div><strong>Added:</strong> ${new Date(sound.dateAdded).toLocaleString()}</div>
            `;
            
            document.getElementById('editModal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditingSoundId = null;
        }

        function saveCurrentSound() {
            if (!currentEditingSoundId) return;
            
            const sound = sounds.find(s => s.id === currentEditingSoundId);
            if (!sound) return;
            
            sound.name = document.getElementById('editName').value;
            
            saveSounds();
            renderSounds();
            closeEditModal();
        }

        function deleteCurrentSound() {
            if (!currentEditingSoundId) return;
            
            if (currentSoundId === currentEditingSoundId) {
                stopSound();
            }
            
            sounds = sounds.filter(s => s.id !== currentEditingSoundId);
            saveSounds();
            renderSounds();
            closeEditModal();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                stopSound();
                closeImportModal();
                closeEditModal();
            }
        });

        // Prevent context menu on touch devices
        document.addEventListener('contextmenu', function(e) {
            if (e.target.closest('.sound-card')) {
                e.preventDefault();
            }
        });
    </script>

    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIk15IFNvdW5kYm9hcmQiLAogICJzaG9ydF9uYW1lIjogIlNvdW5kYm9hcmQiLAogICJkZXNjcmlwdGlvbiI6ICJBIG1vYmlsZS1mcmllbmRseSBzb3VuZGJvYXJkIGFwcCIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgInRoZW1lX2NvbG9yIjogIiMwMDdBRkYiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNGMkYyRjciLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAyNCAyNCcgZmlsbD0nJTIzMDA3QUZGJz48cGF0aCBkPSdNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnptLTIgMTQuNXYtOWw2IDQuNS02IDQuNXonLz48L3N2Zz4iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
</html>
